# Architecture

## Overview

At the core of Jobico-fn's architecture lies its ability to process events asynchronously. Events are queued up and processed by worker functions, allowing for efficient and scalable event handling. This architecture ensures that events are processed in a timely and reliable manner, even under heavy loads.

![alt](docs/img/architecture.svg?)

## Components

### Listener (cmd/listener, internal/listener)

The **Listener** service serves as the entry point for external events, providing a REST API that can function as a [webhook](https://en.wikipedia.org/wiki/Webhook). Its primary responsibilities include receiving events, validating them against pre-defined JSON schemas, and subsequently enqueueing them for further processing. This component acts as the bridge between external sources triggering events and the internal processing pipeline.

![alt](docs/img/listener.svg?)


### Control Service (cmd/ctl, internal/ctl)

The **Control Service** is a centralized hub where Job definitions are stored and can be queried by other components in the system. It acts as the authoritative source for managing job configurations, allowing dynamic adjustments to the processing logic without interrupting the overall system operation. This service facilitates coordination and control over the execution of jobs across the entire platform.

![alt](docs/img/ctl.svg?)

### Queue (cmd/queue, internal/queue)

The **Queue** component acts as a chronological buffer for events, temporarily storing them until they can be processed by the Job Executors. Events are maintained in the queue in the order they are received, ensuring a sequential flow of processing. This component plays a crucial role in decoupling the event reception from the actual event processing, allowing for scalability and efficient handling of bursts of incoming events.

![alt](docs/img/queue.svg?)

### Job Executors (cmd/executor, internal/executor)

**Job Executors** are responsible for consuming events from the Queue and providing a controlled environment for the execution of WebAssembly (WASM) functions that process these events. This component manages the execution context, ensuring isolation and security for running custom WASM programs written by tenants. It plays a key role in the dynamic and scalable execution of programmed jobs in response to events.

![alt](docs/img/executor.svg?)

### File Repository (cmd/repo, internal/repo)

The **File Repository** serves as a storage facility for WebAssembly (WASM) programs and JSON schema files. It provides a dedicated API for storing and retrieving these essential files, ensuring accessibility for the Job Executors and enabling tenants to manage their custom program logic efficiently. This component acts as a repository for the building blocks required for event processing.

![alt](docs/img/repository.svg?)

### Executions Recorder (cmd/recorder, internal/recorder)

The **Executions Recorder** is a service designed to store log information generated by the Job Executors during the execution of jobs. This component acts as a centralized logging system, allowing for post-execution analysis, troubleshooting, and performance monitoring. The recorded information can be queried using both the Command Line Interface (CLI) and Dashboard tools, providing visibility into the historical execution details of jobs.

![alt](docs/img/recorder.svg?)

## GRPC Streaming 

The **GRPC Streaming** capability enables real-time monitoring and reaction to changes within the pltaform, facilitating dynamic adjustments, and enhancing the responsiveness of Jobico-fn to evolving requirements.

![alt](docs/img/streaming.svg?)

#### Job definitions streaming 

The CTL service uses streaming to propogate job definition changes to dependent services. Through persistent bidirectional communication channels, this service continuously streams updates to subscribing services, ensuring timely synchronization and consistent execution across the Jobico-fn ecosystem.

![alt](docs/img/updates.svg?)

#### Results streaming 

The Recorder service utilizes streaming to instantly relay execution results to admin tools, providing users with real-time display of information.

![alt](docs/img/streamingresult.svg?)

## Goico: The Jobico-fn Framework

### Overview:

**Goico** is a specialized [Go](https://go.dev/) framework crafted to support the development and evolution of Jobico initiatives. 

### Key Features:

#### 1. Service Creation and API Exposure:

Goico simplifies the development of services within the Jobico ecosystem. It supports creating services that expose REST or gRPC APIs, fostering a modular and scalable architecture. 

#### 2. WASM Runtime Based on WAZERO:

Goico enables the utilization of WebAssembly (WASM) runtimes via WAZERO, providing the capability to execute custom logic written in various programming languages compatible with WASM.

#### 3. Key/Value Embedded Database:

Goico integrates an embedded database based on [Pebble](https://github.com/cockroachdb/pebble), offering a key/value store for data management. This embedded database serves as the backbone for storing critical information, supporting the reliable and fast retrieval of data essential for the operation of Jobico.


#### For additional details [click here](https://github.com/andrescosta/goico).